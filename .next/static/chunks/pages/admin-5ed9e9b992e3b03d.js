(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return r(726)}])},726:function(e,n,r){"use strict";r.r(n),r.d(n,{__N_SSP:function(){return b},default:function(){return C}});var t=r(5893),a=r(7294),o=r(3165),s=r(2553),i=r(8366),c=r(8277),u=r(4051),d=r.n(u),l=r(2049),h=r(6979),f=r(7690),x=r(7501);function j(e,n,r,t,a,o,s){try{var i=e[o](s),c=i.value}catch(u){return void r(u)}i.done?n(c):Promise.resolve(c).then(t,a)}var v=function(e){var n=e.setEditing,r=e.setCurrentStatus,i=function(e){return e.toISOString().split("T")[0]},c=(0,a.useState)(""),u=c[0],v=c[1],g=(0,a.useState)(""),p=g[0],Z=g[1],P=(0,a.useState)(""),m=P[0],b=P[1],C=(0,a.useState)(""),w=C[0],y=C[1],S=(0,a.useState)({error:null,loading:!1,done:!1}),D=S[0],E=S[1],_=i(new Date),k=function(){var e,t=(e=d().mark((function e(){var t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,E({error:null,done:!1,loading:!0}),e.next=4,fetch("/api/admin/cart/dates",{method:"POST",body:JSON.stringify({openDate:u,closeDate:p})});case 4:return t=e.sent,e.next=7,t.json();case 7:a=e.sent,r(a),E({error:null,loading:!1,done:!0}),n(!1),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),E({error:"Ocurri\xf3 un error enviando las fechas",loading:!1,done:!0}),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})),function(){var n=this,r=arguments;return new Promise((function(t,a){var o=e.apply(n,r);function s(e){j(o,t,a,s,i,"next",e)}function i(e){j(o,t,a,s,i,"throw",e)}s(void 0)}))});return function(){return t.apply(this,arguments)}}();return(0,t.jsxs)(o.Z,{children:[(0,t.jsxs)(s.ZP.Container,{gap:3,justify:"center",children:[(0,t.jsxs)(s.ZP,{children:[(0,t.jsx)(l.ZP,{type:"date",label:"Nueva fecha de apertura",min:_,value:u,onChange:function(e){var n=e.target.value;b(""),y(""),v(n);var r=new Date(n);n&&(r.setDate(r.getDate()+1),Z(i(r)))}}),(0,t.jsx)(h.Z,{color:"error",children:m})]}),(0,t.jsxs)(s.ZP,{children:[(0,t.jsx)(l.ZP,{type:"date",label:"Nueva fecha de cierre",disabled:""===u,min:function(){if(!u)return"";var e=new Date(u);return e.setDate(e.getDate()+1),i(e)}(),value:p,onChange:function(e){y(""),Z(e.target.value)}}),(0,t.jsx)(h.Z,{color:"error",children:w})]})]}),(0,t.jsx)(f.ZP,{onClick:function(){return n(!1)},className:D.loading?"button-total-disabled":"button-cancel",children:"Cancelar"}),(0,t.jsx)(f.ZP,{onClick:function(){(function(){b(""),y("");var e=!0;return u||(b("Debe ingresar una fecha de apertura"),e=!1),p||(y("Debe ingresar una fecha de cierre"),e=!1),u&&p&&new Date(p)<=new Date(u)&&(y("La fecha de cierre debe ser mayor que la de apertura"),e=!1),e})()&&k()},className:D.loading?"button-total-disabled":"button-total",children:"Confirmar"}),(0,t.jsxs)(s.ZP.Container,{gap:2,direction:"column",justify:"center",children:[D.loading&&(0,t.jsx)(x.ZP,{color:"warning"}),D.done&&D.error&&(0,t.jsx)(h.Z,{children:D.error})]})]})},g=r(8754);function p(e,n,r,t,a,o,s){try{var i=e[o](s),c=i.value}catch(u){return void r(u)}i.done?n(c):Promise.resolve(c).then(t,a)}var Z=function(e){var n=e.ordersCount,r=e.setOrdersCount,i=(0,a.useState)({error:null,loading:!1,done:!1}),c=i[0],u=i[1],l=function(){var e,n=(e=d().mark((function e(){var n,t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u({error:null,loading:!0,done:!1}),e.next=4,(0,g.g4)();case 4:return n=e.sent.orders,e.next=7,fetch("/api/admin/orders",{method:"POST",body:JSON.stringify({orders:n})});case 7:return t=e.sent,e.next=10,t.json();case 10:if(e.sent.error){e.next=15;break}r(0),u({error:null,loading:!1,done:!0}),e.next=16;break;case 15:throw new Error("Error enviando los pedidos");case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),u({error:"Ocurri\xf3 un error enviando los pedidos",loading:!1,done:!0});case 21:case"end":return e.stop()}}),e,null,[[0,18]])})),function(){var n=this,r=arguments;return new Promise((function(t,a){var o=e.apply(n,r);function s(e){p(o,t,a,s,i,"next",e)}function i(e){p(o,t,a,s,i,"throw",e)}s(void 0)}))});return function(){return n.apply(this,arguments)}}();return(0,t.jsxs)(o.Z,{children:[(0,t.jsxs)(s.ZP.Container,{justify:"center",direction:"column",alignItems:"center",children:[(0,t.jsx)(h.Z,{h3:!0,children:"Pedidos guardados hasta ahora (sin enviar)"}),(0,t.jsx)(h.Z,{h2:!0,children:n}),(0,t.jsx)(f.ZP,{onClick:l,className:c.loading?"button-total-disabled":"button-total",children:"Enviar pedidos"})]}),(0,t.jsxs)(s.ZP.Container,{gap:2,direction:"column",justify:"center",children:[c.loading&&(0,t.jsx)(x.ZP,{color:"warning"}),c.done&&(c.error?(0,t.jsx)(h.Z,{color:"error",children:c.error}):(0,t.jsx)(h.Z,{children:"Pedidos enviados con \xe9xito"}))]})]})},P=function(e){var n=e.status,r=e.setEditing;return(0,t.jsx)(o.Z,{children:(0,t.jsxs)(s.ZP.Container,{justify:"center",direction:"column",alignItems:"center",children:[(0,t.jsx)(h.Z,{h3:!0,children:"Estado actual del carrito"}),(0,t.jsx)(h.Z,{h4:!0,children:{open:"Abierto",toOpen:"Abre pronto",closed:"Cerrado"}[n.status]}),(0,t.jsxs)(s.ZP.Container,{justify:"space-around",children:[(0,t.jsx)(s.ZP,{children:(0,t.jsxs)(h.Z,{children:["Fecha de apertura: ",(0,t.jsx)("strong",{children:n.openDate})]})}),(0,t.jsx)(s.ZP,{children:(0,t.jsxs)(h.Z,{children:["Fecha de cierre: ",(0,t.jsx)("strong",{children:n.closeDate})]})})]}),(0,t.jsx)(f.ZP,{onClick:function(){return r(!0)},className:"button-total",children:"Editar fechas"})]})})},m=r(8662),b=!0;function C(e){var n=(0,a.useState)(!1),r=n[0],u=n[1],d=(0,a.useState)(e.ordersCount),l=d[0],h=d[1],f=(0,a.useState)(e.currentStatus),x=f[0],j=f[1];return(0,a.useEffect)((function(){return(0,m.o)()}),[]),(0,t.jsxs)(i.default,{children:[(0,t.jsx)(c.Z,{user:e.user,title:"Panel de administrador"}),(0,t.jsx)(o.Z,{children:(0,t.jsxs)(s.ZP.Container,{justify:"center",alignItems:"center",gap:4,children:[(0,t.jsx)(s.ZP,{xs:12,sm:10,md:6,lg:4,children:(0,t.jsx)(Z,{ordersCount:l,setOrdersCount:h})}),(0,t.jsx)(s.ZP,{xs:12,sm:10,md:6,lg:4,children:r?(0,t.jsx)(v,{setEditing:u,setCurrentStatus:j}):(0,t.jsx)(P,{status:x,setEditing:u})})]})})]})}}},function(e){e.O(0,[523,139,710,218,49,73,774,888,179],(function(){return n=577,e(e.s=n);var n}));var n=e.O();_N_E=n}]);